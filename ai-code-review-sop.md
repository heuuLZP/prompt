# AI 辅助 Code Review 标准工作流 (SOP)

这套工作流的核心思想是：将 AI 从一个简单的代码执行者，转变为一个能够深入理解代码、与您共同探讨设计、并沉淀文档的 **“技术伙伴”**。

---

### **阶段一：准备与范围定义 (Preparation & Scoping)**

**目标**：让 AI 快速建立上下文，明确 Review 的范围和核心目标。

**关键行动**:

1. 提供代码改动的范围（如两个 commit ID，或一个分支）。
2. 简述本次改动的核心业务目标（如“重构 A 功能”、“修复 B Bug”）。
3. 让 AI做的第一件事是 **列出所有被修改的文件**，以建立宏观认知。

**给 AI 的提示词示例**:

> “你好，我需要你帮我 review 一段代码改动。
> 
> - **起始 Commit ID**: `<start_commit_hash>`
> - **结束 Commit ID**: `HEAD` (或 `<end_commit_hash>`)
> - **核心目标**: 本次改动主要是为了将系统中写死的“门店”文案，替换为通过接口动态获取的“组织单元”名称。
> 
> **你的第一个任务是**：通过 `git diff` 告诉我从起始到结束，总共修改了哪些文件，让我对改动范围有个整体了解。”

---

### **阶段二：宏观分析与计划制定 (High-Level Analysis & Planning)**

**目标**：避免陷入代码细节，让 AI 先从架构和模块层面规划 Review 路径。

**关键行动**:

1. 拿到文件列表后，禁止 AI 立即开始逐行解释代码。
2. 要求 AI 根据文件关联性和功能，**制定一个分模块、分步骤的 Review 计划**。

**给 AI 的提示词示例**:

> “好的，文件范围已经明确。现在，请为我制定一个详细的 Review 计划。
> 
> 我不希望你一次性展示所有代码，而是将这些改动按 **逻辑模块** 进行拆分（例如可以分为：核心工具类改动、A 功能组件改动、B 功能组件改动、状态管理逻辑改动等）。
> 
> 请先向我展示你的拆分计划，待我确认后，我们再逐一深入。”

---

### **阶段三：分步深度审查与探讨 (Step-by-Step In-Depth Review)**

**目标**：聚焦于单个模块，进行深入、有主题的分析，而不只是“看代码”。

**关键行动**:

1. 按照第二步制定的计划，逐一命令 AI 分析每个模块。
2. 要求 AI 在展示 `diff` 的同时，必须从更高维度进行解读，如：
  - **设计模式**：这里采用了什么设计模式（如策略模式、工厂模式）？有什么优缺点？
  - **可维护性**：这样的修改是否易于未来扩展？是否降低了耦合度？
  - **健壮性**：是否考虑了异常情况和边界条件（如 null、undefined）？
  - **代码意图**：为什么要这样改，解决了什么根本问题？

**给 AI 的提示词示例**:

> “同意你的计划，我们开始第一部分：[模块名，如 `industryTextHelper.ts` 的分析]。
> 
> 请展示这个文件的 `diff`，并结合代码回答以下问题：
> 
> 1. 这个模块的核心设计思想是什么？
> 2. 从可维护性和健壮性角度，评价一下这次改动。
> 3. 你认为这里有哪些值得学习或可以改进的地方？”

---

### **阶段四：互动式探索、修复与重构 (Interactive Exploration, Fixing & Refactoring)**

**目标**：将 Review 从被动的“听”，变为主动的“问”和“改”。利用 AI 的强大能力，即时验证想法和修复问题。

**关键行动**:

1. 对任何有疑问的代码点，立即向 AI 提问。
2. 如果发现问题或有优化建议，直接命令 AI 进行搜索、分析，甚至生成修复后的代码。

**给 AI 的提示词示例**:

> **（探索式提问）**
> “我对 `[函数名/变量名]` 的作用不太理解，它为什么要这样设计？在当前项目中，除了这里，还有哪些地方用到了它？请搜索并解释一下。”
> 
> **（指令式修复）**
> “我发现 `[某处代码]` 的实现可能存在风险，比如直接使用了共享常量，可能导致状态污染。请你：
> 
> 1. 确认我的判断是否正确。
> 2. 如果正确，请立即修复这个问题，将所有直接使用该常量的地方，替换为使用工厂函数。
> 3. 向我展示所有相关的 `replace` 操作。”

---

### **阶段五：总结与文档沉淀 (Summary & Documentation)**

**目标**：将 Review 过程中的高质量分析和讨论，转化为可长期复用的项目文档。

**关键行动**:

1. 在 Review 结束后，要求 AI 对整个模块进行总结。
2. 提出明确的文档结构要求，让 AI 生成结构化的分析文档。
3. 对文档的呈现形式（如图表风格）进行迭代和优化。

**给 AI 的提示词示例**:

> “非常感谢你的 Review 和修复。为了方便团队后续维护，现在请为 `[模块名]` 模块生成一份架构分析文档，并直接写入到该目录下，命名为 `_ARCHITECTURE.md`。
> 
> 我希望文档包含：
> 
> 1. 核心目录和文件结构分析。
> 2. 一张表格，清晰说明每个 Tab 页对应的表单和表格分别由哪个文件控制。
> 3. 为每个主要 Tab 页，用 [风格名，如“嵌套矩形”] 风格绘制一棵 ASCII 组件结构树。
> 
> 请一步到位，直接执行 `write_file` 操作。”
